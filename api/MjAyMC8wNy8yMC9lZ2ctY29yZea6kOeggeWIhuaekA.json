{"title":"egg-core源码分析","date":"2020-07-20T07:05:18.547Z","date_formatted":{"ll":"Jul 20, 2020","L":"07/20/2020","MM-DD":"07-20"},"link":"2020/07/20/egg-core源码分析","tags":["egg"],"categories":["编程技术"],"updated":"2020-07-20T07:05:18.548Z","content":"<a id=\"more\"></a>\n<h3 id=\"一.egg-core-的结构\">一.egg-core 的结构<a title=\"#一.egg-core-的结构\" href=\"#一.egg-core-的结构\"></a></h3>\n<p>Egg.js 的大部分核心代码实现都在 egg-core 库 中，egg-core 主要 export 四个对象:</p>\n<ol>\n<li>EggCore 类：继承于 Koa ，做一些初始化工作， EggCore 中最主要的一个属性是 loader ，也就是 egg-core 的导出的第二个类 EggLoader 的实例</li>\n<li>EggLoader 类：整个框架目录结构（controller，service，middleware，extend，router.js）的加载和初始化工作都在该类中实现的，主要提供了几个 load 函数(loadPlugin，loadConfig，loadMiddleware，loadService，loadController，loadRouter 等)，这些函数会根据指定目录结构下文件输出形式不同进行适配，最终挂载输出内容。</li>\n<li>BaseContextClass 类：这个类主要是为了我们在使用框架开发时，在 controller 和 service 作为基类使用，只有继承了该类，我们才可以通过 this.ctx 获取到当前请求的上下文对象</li>\n<li>utils 对象：提供几个主要的函数，包括转换成中间件函数 middleware ，根据不同类型文件获取文件导出内容函数 loadFile 等</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; egg-core 源码 -&gt; 导出的数据结构</span><br><span class=\"line\">const EggCore &#x3D; require(&#39;.&#x2F;lib&#x2F;egg&#39;);</span><br><span class=\"line\">const EggLoader &#x3D; require(&#39;.&#x2F;lib&#x2F;loader&#x2F;egg_loader&#39;);</span><br><span class=\"line\">const BaseContextClass &#x3D; require(&#39;.&#x2F;lib&#x2F;utils&#x2F;base_context_class&#39;);</span><br><span class=\"line\">const utils &#x3D; require(&#39;.&#x2F;lib&#x2F;utils&#39;);</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports &#x3D; &#123;</span><br><span class=\"line\">  EggCore,</span><br><span class=\"line\">  EggLoader,</span><br><span class=\"line\">  BaseContextClass,</span><br><span class=\"line\">  utils,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n","prev":{"title":"Node和进程线程","link":"2020/07/20/Node和进程线程"},"next":{"title":"Inside主题配置","link":"2020/07/20/Inside主题"},"plink":"http://qiuxiaori.github.com/2020/07/20/egg-core源码分析/","toc":[{"id":"一.egg-core-的结构","title":"一.egg-core 的结构","index":"1"}],"copyright":{"author":"Qiu Xiaori","license":"自由转载-非商用-禁止演绎-保持署名（CC BY-NC-ND 4.0)","link":"<a href=\"http://qiuxiaori.github.com/2020/07/20/egg-core源码分析/\" title=\"egg-core源码分析\">http://qiuxiaori.github.com/2020/07/20/egg-core源码分析/</a>"}}