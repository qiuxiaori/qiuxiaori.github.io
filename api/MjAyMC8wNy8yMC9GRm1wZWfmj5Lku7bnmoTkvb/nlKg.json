{"title":"FFmpegæ’ä»¶çš„ä½¿ç”¨","date":"2020-07-20T07:05:18.546Z","date_formatted":{"ll":"Jul 20, 2020","L":"07/20/2020","MM-DD":"07-20"},"link":"2020/07/20/FFmpegæ’ä»¶çš„ä½¿ç”¨","tags":["æ–‡ä»¶"],"categories":["ç¼–ç¨‹æŠ€æœ¯"],"updated":"2020-07-20T07:05:18.546Z","content":"<blockquote>\n<p>FFmpeg æ˜¯ä¸€ä¸ªè‡ªç”±è½¯ä»¶ï¼Œå¯ä»¥è¿è¡ŒéŸ³é¢‘å’Œè§†é¢‘å¤šç§æ ¼å¼çš„å½•å½±ã€è½¬æ¢ã€æµåŠŸèƒ½ï¼ŒåŒ…å«äº† libavcodecâ€”â€”è¿™æ˜¯ä¸€ä¸ªç”¨äºå¤šä¸ªé¡¹ç›®ä¸­éŸ³é¢‘å’Œè§†é¢‘çš„è§£ç å™¨åº“ï¼Œä»¥åŠ libavformatâ€”â€”ä¸€ä¸ªéŸ³é¢‘ä¸è§†é¢‘æ ¼å¼è½¬æ¢åº“ã€‚ â€œFFmpegâ€è¿™ä¸ªå•è¯ä¸­çš„â€œFFâ€æŒ‡çš„æ˜¯â€œFast Forwardâ€ã€‚<a href=\"https://www.npmjs.com/package/ffmpeg\" target=\"_blank\">ffmpeg</a>æ’ä»¶æä¾›äº†ä¸€ç»„å‡½æ•°å’Œå®ç”¨ç¨‹åºæ¥æŠ½è±¡ ffmpeg çš„å‘½ä»¤è¡Œç”¨æ³•ã€‚</p>\n</blockquote>\n<a id=\"more\"></a>\n<h2 id=\"ä¸€.å®‰è£…-ffmpeg\">ä¸€.å®‰è£… ffmpeg<a title=\"#ä¸€.å®‰è£…-ffmpeg\" href=\"#ä¸€.å®‰è£…-ffmpeg\"></a></h2>\n<ol>\n<li>å®‰è£… ffmpeg è½¯ä»¶<br>\nä½¿ç”¨ ffmpeg æ’ä»¶é¦–å…ˆéœ€è¦ç”µè„‘æœ‰ ffmpeg è½¯ä»¶ç¯å¢ƒï¼Œå®‰è£… ffmpeg éœ€è¦ brew ç¯å¢ƒã€‚</li>\n</ol>\n<ul>\n<li>\n<p>å®‰è£… brew,æ‰§è¡Œä»¥ä¸‹å‘½ä»¤<br>\n<code>/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code><br>\nè¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰ vpn çš„è¯æœ‰ç‚¹æ…¢ï¼Œå¯ä»¥æœç´¢å…¶ä»–å®‰è£…æ–¹å¼ï¼Œè¿™é‡Œä¸ç»†è®²ã€‚</p>\n</li>\n<li>\n<p>å®‰è£… ffmpegï¼Œ<br>\n<code>brew install ffmpe</code><br>\nè¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¦å®‰è£…å¾ˆå¤šä¸œè¥¿ï¼Œæœ‰ç‚¹ä¹…ï¼Œè¿˜å¯ä»¥åˆ°å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…ï¼Œä¸è¿‡éœ€è¦é…ç½®ï¼Œè‡ªè¡Œè°·æ­Œå§ã€‚</p>\n</li>\n</ul>\n<ol start=\"2\">\n<li>\n<p>å®‰è£…æ’ä»¶<br>\nåœ¨é¡¹ç›®ä¸­æ‰§è¡Œä¸‹é¢ ğŸ‘‡ çš„å‘½ä»¤<br>\n<code>npm install ffmpeg</code></p>\n</li>\n<li>\n<p>å¼•å…¥æ’ä»¶<br>\n<code>var ffmpeg = require('ffmpeg');</code></p>\n</li>\n<li>\n<p>ä½¿ç”¨æ’ä»¶åˆ›å»ºå®ä¾‹<br>\nffmpeg æ’ä»¶ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨å›è°ƒå‡½æ•°æˆ– Promise ä¸¤ç§æ–¹å¼è°ƒç”¨ã€‚</p>\n</li>\n</ol>\n<ul>\n<li>å›è°ƒå‡½æ•°æ–¹å¼```js<br>\nnew ffmpeg(â€˜/path/to/your_movie.aviâ€™, function (err, video) {<br>\nif (!err) {<br>\nconsole.log(â€˜The video is ready to be processedâ€™);<br>\n} else {<br>\nconsole.log('Error: â€™ + err);<br>\n}<br>\n});</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">* Promiseæ–¹å¼&#96;&#96;&#96;js</span><br><span class=\"line\">  var process &#x3D; new ffmpeg(&#39;&#x2F;path&#x2F;to&#x2F;your_movie.avi&#39;);</span><br><span class=\"line\">  process.then(function (video) &#123;</span><br><span class=\"line\">    console.log(&#39;The video is ready to be processed&#39;);</span><br><span class=\"line\">  &#125;, function (err) &#123;</span><br><span class=\"line\">    console.log(&#39;Error: &#39; + err);</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"äºŒ.video-å¯¹è±¡\">äºŒ.Video å¯¹è±¡<a title=\"#äºŒ.video-å¯¹è±¡\" href=\"#äºŒ.video-å¯¹è±¡\"></a></h2>\n<h3 id=\"video-å¯¹è±¡å±æ€§\">video å¯¹è±¡å±æ€§<a title=\"#video-å¯¹è±¡å±æ€§\" href=\"#video-å¯¹è±¡å±æ€§\"></a></h3>\n<p>æ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹æ—¶ï¼Œæ­¤åº“éƒ½ä¼šæä¾›ä¸€ä¸ªæ–°å¯¹è±¡æ¥æ£€ç´¢è§†é¢‘ä¿¡æ¯ï¼Œffmpeg é…ç½®ä»¥åŠè¿›è¡Œå¿…è¦è½¬æ¢çš„æ‰€æœ‰æ–¹æ³•ï¼š```js<br>\nvar process = new ffmpeg(â€˜/path/to/your_movie.aviâ€™);<br>\nprocess.then(function (video) {<br>\nconsole.log(video.metadata); // Video metadata<br>\nconsole.log(video.metadata.duration.seconds) // Video çš„æ—¶é•¿<br>\nconsole.log(video.info_configuration); // FFmpeg configuration<br>\n}, function (err) {<br>\nconsole.log('Error: â€™ + err);<br>\n});</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">### videoå¯¹è±¡æ–¹æ³•</span><br><span class=\"line\">videoå¯¹è±¡é¢„è®¾ä¸€ç»„æ–¹æ³•ï¼Œå¯ä»¥ç‹¬ç«‹äºé¢„è®¾é…ç½®è¿›è¡Œç‹¬ç«‹æ“ä½œã€‚</span><br><span class=\"line\">1. **video.fnExtractSoundToMP3(destionationFileNameï¼Œcallback)**</span><br><span class=\"line\">è¿™ä¸ªæ–¹æ³•ä¼šæŠŠè§†é¢‘çš„éŸ³é¢‘æµæå–ä¸ºmp3æ–‡ä»¶ã€‚</span><br><span class=\"line\">**å‚æ•°ï¼š**</span><br><span class=\"line\">* destionationFileNameï¼šè¦å¯¼å‡ºçš„æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼š</span><br><span class=\"line\">&#96;&#x2F;path&#x2F;to&#x2F;your_audio_file.mp3&#96;</span><br><span class=\"line\"></span><br><span class=\"line\">* callback: (å¯é€‰ï¼‰å¦‚æœåœ¨è¿›ç¨‹ç»“æŸæ—¶æŒ‡å®šï¼Œå®ƒå°†è¿”å›æ–°éŸ³é¢‘æ–‡ä»¶çš„è·¯å¾„ï¼š</span><br><span class=\"line\">&#96;function (error, file)&#96;</span><br><span class=\"line\">**ä¾‹ï¼š**&#96;&#96;&#96;js</span><br><span class=\"line\">  var process &#x3D; new ffmpeg(&#39;&#x2F;path&#x2F;to&#x2F;your_movie.avi&#39;);</span><br><span class=\"line\">  process.then(function (video) &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; Callback mode</span><br><span class=\"line\">   video.fnExtractSoundToMP3(&#39;&#x2F;path&#x2F;to&#x2F;your_audio_file.mp3&#39;, function (error, file) &#123;</span><br><span class=\"line\">    if (!error)</span><br><span class=\"line\">    console.log(&#39;Audio file: &#39; + file);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  &#125;, function (err) &#123;</span><br><span class=\"line\">   console.log(&#39;Error: &#39; + err);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#96;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li><strong>video.fnExtractFrameToJPG(destinationFolder,settings, callback)</strong><br>\nè¿™ä¸ªæ–¹æ³•å°±æ˜¯å¸®åŠ©å®ç°è¿™æ¬¡éœ€æ±‚çš„ä¸»è¦æ–¹æ³•å•¦ï¼Œå®ƒèƒ½æˆªå–è§†é¢‘çš„ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ï¼Œè¿”å›ç»™æˆ‘ä»¬ä¸€ä¸ªå›¾åƒæ•°ç»„ã€‚<br>\n<strong>å‚æ•°ï¼š</strong></li>\n</ol>\n<ul>\n<li>destinationFolder:ç”Ÿæˆçš„å¸§çš„ç›®æ ‡æ–‡ä»¶å¤¹<br>\n<code>/path/to/you_file</code></li>\n<li>setting:( å¯é€‰ï¼‰æ›´æ”¹é»˜è®¤è®¾ç½®çš„è®¾ç½®ï¼š```js<br>\n{<br>\nstart_time: number, // å¼€å§‹çš„æ—¶é—´,ä¸å¤ªæ”¯æŒ<br>\nduration_time: number, // æŒç»­çš„æ—¶é—´<br>\nframe_rate: number, // æ¯ç§’çš„å¸§æ•°<br>\nkeep_aspect_ratio: false, // ä¿æŒå®½é«˜æ¯”<br>\nsize: number, // æˆªå–å›¾ç‰‡çš„å°ºå¯¸ ä¸å¤ªæ”¯æŒ<br>\nnumber: number, // è¦æˆªå–çš„å¸§æ•°<br>\nevery_n_frames: number, // é—´éš”å‡ å¸§æˆªå–<br>\nevery_n_seconds: number, // é—´éš”å‡ ç§’æˆªå–ï¼Œä¸å¤ªæ”¯æŒ<br>\nevery_n_percentage: number,// é—´éš”ç™¾åˆ†æ¯”æˆªå–ï¼Œä¸å¤ªæ”¯æŒ<br>\nkeep_pixel_aspect_ratio: true,// Mantain the original pixel video aspect ratio<br>\npadding_color: â€˜blackâ€™, // Padding color<br>\nfile_name: null,<br>\n}</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">* callback: (å¯é€‰ï¼‰å¦‚æœåœ¨è¿›ç¨‹ç»“æŸæ—¶æŒ‡å®šå°†è¿”å›åˆ›å»ºçš„å¸§çš„è·¯å¾„åˆ—è¡¨ï¼š</span><br><span class=\"line\">&#96;function (error, file)&#96;</span><br><span class=\"line\">**ä¾‹ï¼š**&#96;&#96;&#96;js</span><br><span class=\"line\">  video.fnExtractFrameToJPG(&#39;&#x2F;path&#x2F;to&#x2F;save_your_frames&#39;, &#123;</span><br><span class=\"line\">      frame_rate : 1,</span><br><span class=\"line\">      number : 5,</span><br><span class=\"line\">      file_name : &#39;my_frame_%t_%s&#39;</span><br><span class=\"line\">    &#125;, function (error, files) &#123;</span><br><span class=\"line\">      if (!error)</span><br><span class=\"line\">          console.log(&#39;Frames: &#39; + files);</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li><strong>video.fnAddWatermarkï¼ˆwatermarkPathï¼ŒnewFilepathï¼Œsettingsï¼Œcallback</strong><br>\nè¿™ä¸ªæ–¹æ³•è´Ÿè´£ä¸ºæ­£åœ¨å¼€å‘çš„è§†é¢‘æ·»åŠ æ°´å°ã€‚æ‚¨å¯ä»¥æŒ‡å®šå›¾åƒä½ç½®çš„ç¡®åˆ‡ä½ç½®ã€‚<br>\n<strong>å‚æ•°ï¼š</strong></li>\n</ol>\n<ul>\n<li>watermarkPath: å­˜å‚¨å›¾åƒçš„å®Œæ•´è·¯å¾„<br>\n<code>/path/to/retrieve/watermark_file.png</code></li>\n<li>newFilepath: (å¯é€‰ï¼‰æ–°è§†é¢‘çš„åç§°ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ç”±è¯¥å‡½æ•°åˆ›å»º.<br>\n<code>/path/to/save/your_file_video.mp4</code></li>\n<li>settings: (å¯é€‰ï¼‰æ›´æ”¹é»˜è®¤è®¾ç½®çš„è®¾ç½®.```js<br>\n{<br>\nposition: â€œSWâ€, // Position: NE NC NW SE SC SW C CE CW<br>\nmargin_nord: null, // Margin nord<br>\nmargin_sud: null, // Margin sud<br>\nmargin_east: null, // Margin east<br>\nmargin_west: null, // Margin west<br>\n};</li>\n<li>callback: (å¯é€‰ï¼‰å¦‚æœåœ¨æµç¨‹ç»“æŸæ—¶æŒ‡å®šï¼Œå®ƒå°†è¿”å›åŒ…å«æ°´å°çš„æ–°è§†é¢‘çš„è·¯å¾„.<br>\n<code>function (error, file)</code><br>\n<strong>ä¾‹:</strong>```js<br>\nvideo.fnAddWatermark(â€˜/path/to/retrieve/watermark_file.pngâ€™, â€˜/path/to/save/your_file_video.mp4â€™, {<br>\nposition : â€˜SEâ€™<br>\n}, function (error, file) {<br>\nif (!error)<br>\nconsole.log('New video file: â€™ + file);<br>\n});</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">4. **å…¶ä»–æ–¹æ³•è§npm[ffmpeg](https:&#x2F;&#x2F;www.npmjs.com&#x2F;package&#x2F;ffmpeg)ã€‚**</span><br></pre></td></tr></table></figure>\n","prev":{"title":"Dockerå®æˆ˜ä¹‹mongo","link":"2020/07/20/Dockerå®æˆ˜ä¹‹mongo"},"next":{"title":"ESLintä½¿ç”¨ç®€ä»‹","link":"2020/07/20/Eslintçš„ä½¿ç”¨"},"plink":"http://qiuxiaori.github.com/2020/07/20/FFmpegæ’ä»¶çš„ä½¿ç”¨/","toc":[{"id":"ä¸€.å®‰è£…-ffmpeg","title":"ä¸€.å®‰è£… ffmpeg","index":"1"},{"id":"äºŒ.video-å¯¹è±¡","title":"äºŒ.Video å¯¹è±¡","index":"2","children":[{"id":"video-å¯¹è±¡å±æ€§","title":"video å¯¹è±¡å±æ€§","index":"2.1"}]}],"copyright":{"author":"Qiu Xiaori","license":"è‡ªç”±è½¬è½½-éå•†ç”¨-ç¦æ­¢æ¼”ç»-ä¿æŒç½²åï¼ˆCC BY-NC-ND 4.0)","link":"<a href=\"http://qiuxiaori.github.com/2020/07/20/FFmpegæ’ä»¶çš„ä½¿ç”¨/\" title=\"FFmpegæ’ä»¶çš„ä½¿ç”¨\">http://qiuxiaori.github.com/2020/07/20/FFmpegæ’ä»¶çš„ä½¿ç”¨/</a>"}}