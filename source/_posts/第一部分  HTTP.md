---
title: 《HTTP权威指南》笔记（1）
tags: http
categories: 编程技术
---



## 第一部分  HTTP

### 一.媒体类型

最初设计 MIME (Multipurpose Internet Mail Extension，多用途因特网邮件扩展)是为了解决在不同 的电子邮件系统之间搬移报文时存在的问题。

当 Web 浏览器从服务器中取回一个对象时，会去查看相关的 MIME 类型，看看它是否知道 应该如何处理这个对象。

MIME 类型是一种文本标记，表示一种主要的对象类型和一个特定的子类型，中间由一条斜杠来分隔。

<!--more-->

- HTML 格式的文本文档由 text/html 类型来标记。
- 普通的 ASCII 文本文档由 text/plain 类型来标记。
- JPEG 格式的图片为 image/jpeg 类型。
- GIF 格式的图片为 image/gif 类型。
- Apple 的 QuickTime 电影为 video/quicktime 类型。
- 微软的 PowerPoint 演示文件为 application/vnd.ms-powerpoint 类型。


### 二. URL

1. 定义

   统一资源定位符(URL)是资源标识符最常见的形式。URL 描述了一台特定服务器上某资源的特定位置。它们可以明确说明如何从一个精确、固定的位置获取资源。

2. 格式

   大多数 URL 方案的 URL 语法都建立在这个由 9 部分构成的通用格式上: 

   ```<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>```

3. 自动拓展URL

   * 主机名扩展:在主机名扩展中，只要有些小提示，浏览器通常就可以在没有帮助的情况下，将 你输入的主机名扩展为完整的主机名。

   *  历史扩展:浏览器用来节省用户输入 URL 时间的另一种技巧是，将以前用户访问过的 URL 历史存储起来

4. 浏览器通常会用其他应用程序来处理特殊的资源。比如，Internet Explorer 就启动了一个 E-mail 应用 程序来处理那些表示 E-mail 资源的 URL。

5. URL字符集

   URL 集成了转义序列。通过转义序列，就可以用 US-ASCII 字符集的 有限子集对任意字符值或数据进行编码了，这样就实现了可移植性和完整性。编码机制是通过一种“转义”表示法来表示不安全字符的，这种转义表示法包含一个百分号(%)，后面跟着两个表示字符 ASCII 码的 十六进制数。

   <img src="https://qxr-bucket.oss-cn-beijing.aliyuncs.com/images/转义url.png" alt="image-20210522221654434" style="zoom:60%;" />


### 三. 方法

#### 3.1 常用方法

* get

* post

* put

  PUT方法也改变了资源的状态，所以是 **非安全** 的。但是和POST不同，它是 **幂等** 的。

* delete

  DELETE 方法所做的事情就是请服务器删除请求 URL 所指定的资源。 但是，客户端应用程序无法保证删除操作一定会被执行。

* options

  **OPTIONS 方法请求 Web 服务器告知其支持的各种功能**。可以询问服务器通常支持哪些方法，或者对某些特殊资源支持哪些方法。(有些服务器可能只支持对一些特殊类型的对象使用特定的操作)。

  通过使用 OPTIONS，客户端可以在与服务器进行交互之前，确定服务器的能力，这样它就可以更方便地与具备不同特性的代理和服务器进行互操作了。

  这为客户端应用程序提供了一种手段，使其不用实际访问那些资源就能判定访问各种资源的最优方式。

  **响应：** Allow 实体首部字段列出了请求 URI 标识的资源所支持的方法列表，如果请求 URI为 * 的话，列出的就是整个服务器所支持的方法列表。

* head

  HEAD 方法与 GET 方法的行为很类似，但服务器在响应中只返回首部。不会返回实体的主体部分。这就允许客户端在未获取实际资源的情况下，对资源的首部进行检查。使用 HEAD，可以:

  ​	a. 在不获取资源的情况下了解资源的情况(比如，判断其类型);

  ​	b. 通过查看响应中的状态码，看看某个对象是否存在;

  ​	c. 通过查看首部，测试资源是否被修改了。

* trace

  TRACE 请求会在目的服务器端发起一个 `环回` 诊断。行程最后一站的服务器会弹回一条 TRACE 响应，并在响应主体中携带它收到的原始请求报文。这样客户端就可以查看在所有中间 HTTP 应用程序组成的请求 / 响应链上，原始报文是否，以及如何被毁坏或修改过。

* connect

  CONNECT方法是HTTP/1.1协议预留的，能够将连接改为管道方式的代理服务器。通常用于SSL加密服务器的链接与非加密的HTTP代理服务器的通信。

#### 3.2 安全性与幂等性

| HTTP Method | Idempotent | Safe |
| :---------- | :--------- | :--- |
| OPTIONS     | yes        | yes  |
| GET         | yes        | yes  |
| HEAD        | yes        | yes  |
| PUT         | yes        | no   |
| POST        | no         | no   |
| DELETE      | yes        | no   |
| PATCH       | no         | no   |

### 四. 状态码

表3-7 成功状态码和原因短语

状态码 原因短语

1. 200  OK
2. 201  Created
3. 202  Accepted
4. 203  Non-Authoritative Information
5. 204  No Content
6. 205  Reset Content
7. 206  Partial Content

含  义

请求没问题，实体的主体部分包含了所请求的资源

用于创建服务器对象的请求(比如，PUT)。响应的实体主体部分中 应该包含各种引用了已创建的资源的 URL，Location 首部包含的 则是最具体的引用。更多有关 Location 首部的信息参见表 3-21。 服务器必须在发送这个状态码之前创建好对象

请求已被接受，但服务器还未对其执行任何动作。不能保证服务器会 完成这个请求;这只是意味着接受请求时，它看起来是有效的。 服务器应该在实体的主体部分包含对请求状态的描述，或许还应该有 对请求完成时间的估计(或者包含一个指针，指向可以获取此信息的 位置)

实体首部(更多有关实体首部的信息参见 3.5.4 节)包含的信息不是 来自于源端服务器，而是来自资源的一份副本。如果中间节点上有一 份资源副本，但无法或者没有对它所发送的与资源有关的元信息(首 部)进行验证，就会出现这种情况。 这种响应码并不是非用不可的;如果实体首部来自源端服务器，响应 为 200 状态的应用程序就可以将其作为一种可选项使用

响应报文中包含若干首部和一个状态行，但没有实体的主体部分。主 要用于在浏览器不转为显示新文档的情况下，对其进行更新(比如刷 新一个表单页面)

另一个主要用于浏览器的代码。负责告知浏览器清除当前页面中的所 有 HTML 表单元素

成功执行了一个部分或 Range(范围)请求。稍后我们会看到，客 户端可以通过一些特殊的首部来获取部分或某个范围内的文档——这 个状态码就说明范围请求成功了。更多有关 Range 首部的内容参见 15.9 节。

206 响应中必须包含 Content-Range、Date 以及 ETag 或 Content- Location 首部

3.4.3 300~399——重定向状态码

重定向状态码要么告知客户端使用替代位置来访问他



表3-10 服务器错误状态码及原因短语

状态码

500 501

原因短语

Internal Server Error Not Implemented

含  义

服务器遇到一个妨碍它为请求提供服务的错误时，使用此状态码

客户端发起的请求超出服务器的能力范围(比如，使用了服务器不 支持的请求方法)时，使用此状态码

HTTP报文 | 69

(续)

66

状态码 原因短语

1. 502  Bad Gateway
2. 503  Service Unavailable
3. 504  Gateway Timeout
4. 505  HTTP Version Not Supported

3.5 首部

含  义

作为代理或网关使用的服务器从请求响应链的下一条链路上收到了 一条伪响应(比如，它无法连接到其父网关)时，使用此状态码

用来说明服务器现在无法为请求提供服务，但将来可以。如果服务 器知道什么时候资源会变为可用的，可以在响应中包含一个 Retry- After 首部。更多有关 Retry-After 首部的信息请参见 3.5.3 节

与状态码 408 类似，只是这里的响应来自一个网关或代理，它们在 等待另一服务器对其请求进行响应时超时了

服务器收到的请求使用了它无法或不愿支持的协议版本时，使用此 状态码。有些服务器应用程序会选择不支持协议的早期版本

### 五. 其他应用程序

1. 代理
2. 缓存
3. 网关
4. 隧道
5. Agent代理

### 6. 首部字段

#### 6.1 通用首部

* Connection： 允许客户端和服务器指定与请求/响应链接有关的选项

* Date： 日期和时间标志，说明报文是什么时间创建的

* MIME-Version：给出了发送端使用的MIME版本

* Trailer：如果报文采用了分块传输编码方式，就可以使用这个首部列出位于报文拖挂部分的首部集合

* Update：给出了发送端可能想要升级使用的新版本或协议

* Via：显示了报文经过的中间节点，（代理，网关

* Cache-Control：缓存控制 *

#### 6.2 请求首部

##### 6.2.1 Accept首部

* Accept：告诉服务器能够发送哪些媒体类型
* Accept-Charset：字符集
* Accept-Encoding：哪些编码方式
* Accept-Language：请求语言

##### 6.2.2 条件请求首部

通过条件请求首部，客户端就可以为请求加上这种限制，要求服务器在对请求 进行响应之前，确保某个条件为真。

* Expect：允许客户端列出某请求所要求的服务器行为
* If-Match： 如果实体标记与文档当前的实体标记相匹配，就获取这份文档
* If-None-Match：如果提供的实体标记与当前文档的实体标记不相符，就获取文档
* If-Range：如果服务器支持范围请求，就请求资源的指定范围？
* Range：允许对文档的某个范围进行条件请求？
* If-Unmodified-Since： 除非在某个指定日期之后资源没有被修改过，否则就限制这个请求
* If-Modified-Since： 除非在某个指定的日期之后资源被修改过，否则就限制这个请求

##### 6.2.3 安全请求首部

* Ahthorization：包含了客户端提供给服务器，以便对其自身进行认证的数据
* Cookie：客户端用它向服务器传送一个令牌——它并不是真正的安全首部，但确实隐含了安全功能 

##### 6.2.4 代理请求首部

* Max-Forward：在通往源端服务器的路径上，将请求转发给其他代理或网关的最大次 数——与 TRACE 方法一同使用
* Proxy-Authorization：与 Authorization 首部相同，但这个首部是在与代理进行认证时使用的

* Proxy-Connection：与 Connection 首部相同，但这个首部是在与代理建立连接时使用的 

#### 6.3 响应首部

##### 6.3.1 常见相应首部

* Age：(从最初创建开始)响应持续时间

* Public：服务器为其资源支持的请求方法列表

* Retry-After：如果资源不可用的话，在此日期或时间重试

* Server Title：对 HTML 文档来说，就是 HTML 文档的源端给出的标题

* Warning：比原因短语中更详细一些的警告报文

##### 6.3.2 协商首部

* Accept-Ranges：对此资源来说，服务器可接受的范围类型

* Vary：服务器查看的其他首部的列表，可能会使响应发生变化;也就是说，这是 一个首部列表，服务器会根据这些首部的内容挑选出最适合的资源版本发 送给客户端

##### 6.3.3 安全响应首部

* Proxy-Authenticate：来自代理的对客户端的质询列表

* Set-Cookie：不是真正的安全首部，但隐含有安全功能;可以在客户端设置一个令牌，
  以便服务器对客户端进行标识 

* Set-Cookie2：与 Set-Cookie 类似

* WWW-Authenticate：来自服务器的对客户端的质询列表

#### 6.4 实体首部

##### 6.4.1 常见实体首部

* Allow：列出了可以对此实体执行的请求方法

* Location：告知客户端实体实际上位于何处;用于将接收端定向到资源的(可能是新的)位置(URL)上去

##### 6.4.2 内容首部

* Content-Base：解析主体中的相对 URL 时使用的基础 URL

* Content-Encoding：对主体执行的任意编码方式

* Content-Language：理解主体时最适宜使用的自然语言

* Content-Length：主体的长度或尺寸

* Content-Location：资源实际所处的位置

* Content-MD5：主体的 MD5 校验和

* Content-Range： 在整个资源中此实体表示的字节范围

* Content-Type：这个主体的对象类型

##### 6.4.3 实体缓存首部
* ETag：与此实体相关的实体标记

* Expires：实体不再有效，要从原始的源端再次获取此实体的日期和时间

* Last-Modified：这个实体最后一次被修改的日期和时间 

#### 6.5 拓展首部



### 七. TCP链接











