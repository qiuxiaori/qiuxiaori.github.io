---
title: http学习
categories: 编程技术
tags: http
---

### 六. http首部

#### 1.  http报文结构

##### 1.1 请求报文

* 报文首部
  * 请求行: 请求方法 URL HTTP版本
  * 首部字段: 请求/通用/实体 首部字段
* 空行: CR + LF
* 报文主体

##### 1.2 响应报文

* 报文首部
  * 状态行: HTTP版本 状态码 描述信息
  * 首部字段: 响应/通用/实体 首部字段
* 空行:  CR + LF
* 报文主体

#### 2. 首部字段概述

##### 2.1 首部字段结构

由字段名和字段值构成，中间用冒号":"分隔，字段值可以有多个。

当出现重复字段时，有些浏览器会优先处理第一次出现的有些相反。

##### 2.2 根据实际用途分类

1. 通用首部字段
2. 请求首部字段: 补充了请求的附加容，客户端信息，响应内容优先级等信息。
3. 响应首部字段: 补充了响应的附加内容，也会要求客户端附加额外的内容信息。
4. 实体首部字段: 针对实体部分使用的首部，补充了资源内容更新时间等与实体有关的信息。

##### 2.4 根据缓存代理和非缓存代理的行为分类

1. 端到端首部(End-to-end Header)

   分在此类别中的首部会转发给请求/响应对应的最终接收目标，且必须保存在由缓存生成的响应中，另外规定它必须被转发。

   翻译成大白话：这些首部字段不论是经过代理转发还是缓存时都必须未经修改的发送给接收方。

2. 逐跳首部(Hop-by-hop Header)

   只对单次转发有效，会因通过缓存或代理而不再转发。

   除以下8个首部字段外都属于端到端首部：

   **Connection、Keep-Alive、Proxy-Authenticate、Proxy-Authorization、Trailer、TE、Transfer-Encoding、Upgrade**

#### 3. 通用首部字段

##### 3.1 Catch-Control

* 作用: 控制缓存的行为。
* 值：

| 指令            | 参数   | 分类 | 说明                                                         |
| --------------- | ------ | ---- | ------------------------------------------------------------ |
| no-cache        | 无     | 通用 | 请求时：不使用缓存资源；响应时：使用缓存前需要确认           |
| no-store        | 无     | 通用 | 暗示包含机密信息，不能缓存                                   |
| public          | 可省略 | 响应 | 其他用户也可利用缓存                                         |
| privete         | 可省略 | 响应 | 仅项特定用户返回响应                                         |
| max-age         |        | 通用 | 缓存过期时间                                                 |
| max-stale       |        | 通用 | 即使过期也照常接收，可指定具体数值，即使过期，只要处在这个指定时间内，依旧会被客户端接收。 |
| only-if-cached  |        | 通用 | 只获取缓存资源，若本地缓存无响应则返回状态码504 Gateway timeout |
| must-revalidate |        | 通用 | 再次验证缓存是否有效，使用此指令会忽略请求的max-stale指令    |
| no-transform    |        | 通用 | 缓存不能改变实体主体的媒体类型                               |
|                 |        |      |                                                              |

##### 3.2 Connection

* 作用：
  * 控制不再转发给代理的首部字段：字段名
  * 管理持久连接：close断开连接
* 分类： 逐跳首部
* 值：首部字段名/'close'

##### 3.3 Date

* 作用： 表明创建豹纹的日期和时间
* 值：RFC1123规定的日期时间格式

##### 3.4 Trailer

* 作用：事先说明在报文主体后记录了哪些首部字段，可应用于1.1版本分块传输编码时。
* 值：首部字段名

##### 3.5 Transfer-Encoding

* 作用：规定了传输报文主体时采用的编码方式，1.1的传输编码方式仅对分块传输编码有效。
* 值：chunked

##### 3.6 Upgrade

* 作用：检测http协议及其他协议是否可以使用更高的版本通信。
* 值：指定的通信协议 如HTTP/1.1

##### 3.7 Via

* 作用： 追踪客户端与服务器之间的请求和响应报文的传输路径，报文在经过代理或网管事会先在首部字段Via中附加该服务器的信息再转发。类似电子邮件的Received首部工作机制。

##### 3.8 Warning

* 作用：告知用户一些与缓存相关的问题的警告。
* 值：[警告码] [警告的主机：端口号] "[内容]" ([日期时间])

#### 4. 请求首部字段

##### 4.1 Accept

* 作用：能够处理的媒体类型及相对优先级。可使用 type/subtype 指定多种类型。
* 值：(权重 q=0～1)媒体类型

##### 4.2 Accept-Charset

* 作用：支持的字符集及优先级，可指定多种，支持q值表示相对优先级
* 值：例：iso-8859-5；q=0.8

##### 4.3 Accept-Encoding

* 作用：支持的内容编码及优先级，可指定多个
* 值：gzip/compress/deflate/identity

##### 4.4 Accept-Language

##### 4.5 Authorization

##### 4.6 Expect

* 作用：告知服务器期望出现的某种特定行为。服务器无法理解期望作出回应而发生错误时，返回状态码 417 Expectation Failed
* 值：例：100-continue

##### 4.7 From

* 作用：使用用户代理的u陪你过户电子邮件地址，使用代理时尽量包含
* 值：邮件地址

##### 4.8 Host

* 作用：请求的资源所处的互联网主机名和端口号，必须包含。

##### 4.9 If-Match



#### 5. 实体首部字段

##### 5.1 Allow

* 作用： 允许的方法。

##### 5.2 Content-Encoding

* 作用：内容编码方式。
* 值：gzip/compress/deflate/identity

##### 5.3 Content-Language

* 作用：主体使用的自然语言。

##### 5.4 Content-Length

* 作用：实体主体部分的大小，单位是字节。

##### 5.5 Content-Location

* 作用：主体返回的资源对应的URL。

##### 5.6 Content-Range

* 作用： 针对范围请求。
* 值： bytes 5001-10000/10000

##### 5.7 Content-Type

* 作用： 实体主体对象的媒体类型。

##### 5.8   Expires

* 作用： 资源失效的日期，不希望对资源缓存时，可以写入与Date相同的时间值。但是有max-age指令时优先处理max-age。

##### 5.9 Last-Modify

* 作用： 上次修改时间。

##### 5.10 Set-Cookie/Cookie



#### 6. 其他首部字段

##### 6.1 DNAT

* 作用：拒绝个人信息被收集
* 值：0：同意被追踪/1：拒绝被追踪



---

### 七. HTTPS

#### 1. http

##### 1.1 缺点

1. 通信使用明文，内容可能被窃听
2. 不验证通信方的身份，有可能遭遇伪装
3. 无法验证报文的完整性，可能遭到篡改，又叫中间人攻击

##### 1.2 对应解决方案

1. 通信加密/内容加密
2. 证书
3. md5 sha1

#### 2. https

我们把添加了加密及认证机制的http称为https

ssl采用公开密钥加密，使用一对非对称的密钥对，公钥用来加密，私钥用来解密

https采用混合加密机制：使用公开加密方式交换共享密钥加密中的密钥，再使用共享密钥加密方式通信，公钥可以使用数字证书认证机构和其相关机关办法的公开密钥证书。



### 九. WebSocket

#### 1. 主要特点

1. 主动推送
2. 减少通信量 只要建立起连接 就希望一直保持连接状态 同时首部新戏很小 通信量也相应减少了

#### 2. 握手请求

为了实现ws通信 需要用到http的Upgrade首部字段 告知服务器通信协议发生变化以达到握手的目的

`Upgrade: webSocket`

对于握手请求 返回状态码101 的响应。

成功建立连接后，通信不再使用HTTP的数据帧，而采用WebSocket独立的数据帧。